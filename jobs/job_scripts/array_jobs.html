

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Array Jobs &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/nris.css?v=69e7a171" />
      <link rel="stylesheet" type="text/css" href="../../_static/universal-navbar.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/statuspal.css" />

  
    <link rel="shortcut icon" href="../../_static/nris.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../_static/statuspal_widget.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Job Scripts" href="../job_scripts.html" />
    <link rel="prev" title="Job Types" href="../choosing_job_types.html" /> 
</head>

<body class="wy-body-for-nav">
<!-- Send url to parent when displayed as iframe -->
<script>
    const valid_orign_url = "https://www.sigma2.no"
    window.addEventListener('message', function(event) {
        if (event.data === 'getDocumentationIframeUrl' && event.origin.startsWith(valid_orign_url)) {
            // path only (/path/example.html)
            const path = window.location.pathname
            // query string (including the initial ? symbol)
            const search = window.location.search
            // Returns the hash (including the initial # symbol)
            const hash = window.location.hash
            const newUrl = path + search + hash;
            event.source.postMessage(newUrl, event.origin)
        }
    })

</script>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/two_factor_authentication.html">One-time-pad (OTP) / Two-factor authentication</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.sigma2.no/project-leader-handbook">Project Leader Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../training/events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/past_training.html">An overview over training events in the past</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/short_instructions.html">Short Instructions Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/opslog.html">Status and maintenance of systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_development/guides/vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/ssh.html#common-ssh-errors">Common SSH errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/ood.html">Open OnDemand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/performance.html">Optimizing storage performance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../overview.html">Running jobs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../submitting.html">Submitting jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../choosing_job_types.html">Job Types</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Array Jobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#array-job-properties">Array job properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specifying-task-ids">Specifying task IDs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#array-job-resources">Array job resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#canceling-array-jobs">Canceling array jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dependencies-between-array-jobs">Dependencies between array jobs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../job_scripts.html">Job Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring.html">Monitoring jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slurm_output.html">Understanding the job output file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../choosing-memory-settings.html">How to choose the right amount of memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../choosing-number-of-cores.html">How to choose the number of cores</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common_job_failures.html">Common job failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance.html">How to check the performance and scaling using Arm Performance Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mkl.html">Using MKL efficiently</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory-bandwidth.html">Efficient use of memory bandwidth on Betzy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallel-calculations.html">Efficient use of processors and network on Betzy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactive_jobs.html">Interactive jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../checkpointing.html">Checkpointing Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../projects_accounting.html">Projects and accounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scratchfiles.html">Local storage for scratch files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html">Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../slurm_commands.html">Useful Slurm commands and tools for managing jobs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../internet-login-compute-nodes.html">Login nodes:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internet-login-compute-nodes.html#compute-nodes">Compute nodes:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/tuning-applications.html">Tuning applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_development/guides_llm.html">Running LLM Models in a Cluster Environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compute resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/hardware_overview.html">Overview over our machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/betzy.html">Betzy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/fram.html">Fram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/olivia.html">Olivia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/saga.html">Saga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/lumi.html">LUMI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../software/modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/licenses.html">Licence and access policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/eessi.html">EESSI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../nird_archive/sandbox-user-guide.html">NIRD Research Data Archive Sandbox (NIRD RDA sandbox)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nird_archive/user-guide.html">NIRD Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nird_service_platform/overview_nird_service_platform.html">NIRD Service Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code_development/overview.html">Code development and tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../overview.html">Running jobs</a></li>
      <li class="breadcrumb-item active">Array Jobs</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="array-jobs">
<span id="id1"></span><h1>Array Jobs<a class="headerlink" href="#array-jobs" title="Link to this heading"></a></h1>
<p>To run many instances of the same job, use the <code class="docutils literal notranslate"><span class="pre">--array</span></code> switch to <code class="docutils literal notranslate"><span class="pre">sbatch</span></code>.
This is useful if you have a lot of data-sets which you want to process in the
same way:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>--array<span class="o">=</span>from-to<span class="w"> </span><span class="o">[</span>other<span class="w"> </span>sbatch<span class="w"> </span>switches<span class="o">]</span><span class="w"> </span>YourScript
</pre></div>
</div>
<p>You can also put the <code class="docutils literal notranslate"><span class="pre">--array</span></code> switch in an <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> line inside the script.
<em>from</em> and <em>to</em> are the first and last task number. Each instance of
<code class="docutils literal notranslate"><span class="pre">YourScript</span></code> can use the environment variable <code class="docutils literal notranslate"><span class="pre">$SLURM_ARRAY_TASK_ID</span></code> for
selecting which data set to use, etc. (The queue system calls the instances
“array tasks”.) For instance:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sbatch<span class="w"> </span>--array<span class="o">=</span><span class="m">1</span>-100<span class="w"> </span>MyScript
</pre></div>
</div>
<p>will run 100 instances of <code class="docutils literal notranslate"><span class="pre">MyScript</span></code>, setting the environment variable
<code class="docutils literal notranslate"><span class="pre">$SLURM_ARRAY_TASK_ID</span></code> to 1, 2, …, 100 in turn.</p>
<section id="array-job-properties">
<h2>Array job properties<a class="headerlink" href="#array-job-properties" title="Link to this heading"></a></h2>
<section id="specifying-task-ids">
<h3>Specifying task IDs<a class="headerlink" href="#specifying-task-ids" title="Link to this heading"></a></h3>
<p>It is possible to specify the task ids in other ways than <code class="docutils literal notranslate"><span class="pre">from-to</span></code>: it can be
a single number, a range (<code class="docutils literal notranslate"><span class="pre">from-to</span></code>), a range with a step size
(<code class="docutils literal notranslate"><span class="pre">from-to:step</span></code>), or a comma separated list of these. Finally, adding <code class="docutils literal notranslate"><span class="pre">%max</span></code> at
the end of the specification puts a limit on how many tasks will be allowed to
run at the same time. A couple of examples:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Specification (<code class="docutils literal notranslate"><span class="pre">--array=</span></code>)</p></th>
<th class="head"><p>Resulting <code class="docutils literal notranslate"><span class="pre">SLURM_ARRAY_TASK_ID</span></code>s</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1,4,42</span></code></p></td>
<td><p>1, 4, 42</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1-5</span></code></p></td>
<td><p>1, 2, 3, 4, 5</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">0-10:2</span></code></p></td>
<td><p>0, 2, 4, 6, 8, 10</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">32,56,100-200</span></code></p></td>
<td><p>32, 56, 100, 101, 102, …, 200</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1-200%10</span></code></p></td>
<td><p>1, 2, …, 200, but maximum 10 running at the same time</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Spaces, decimal numbers or negative numbers are not allowed in the <code class="docutils literal notranslate"><span class="pre">--array</span></code>
specification.</p>
</div>
<p>The queue system allows job arrays with at most 1,000 array tasks, but
the maximal array task ID is 100,000 (thus <code class="docutils literal notranslate"><span class="pre">--array=900-1100</span></code> is allowed).</p>
</section>
<section id="array-job-resources">
<h3>Array job resources<a class="headerlink" href="#array-job-resources" title="Link to this heading"></a></h3>
<p>The instances of an array job are independent, they have their own <code class="docutils literal notranslate"><span class="pre">$SCRATCH</span></code>
(<a class="reference internal" href="../../files_storage/clusters.html#storage-areas"><span class="std std-ref">read more about storage locations here</span></a>) and are treated
like separate jobs. Thus any resources request in the Slurm script is available
for each task.</p>
</section>
<section id="canceling-array-jobs">
<h3>Canceling array jobs<a class="headerlink" href="#canceling-array-jobs" title="Link to this heading"></a></h3>
<p>To cancel all tasks of an array job, cancel the job ID that is returned by
<code class="docutils literal notranslate"><span class="pre">sbatch</span></code>. One can also cancel individual tasks with <code class="docutils literal notranslate"><span class="pre">scancel</span> <span class="pre">&lt;array</span> <span class="pre">job</span> <span class="pre">ID&gt;:&lt;task</span> <span class="pre">ID&gt;</span></code>.</p>
</section>
<section id="dependencies-between-array-jobs">
<h3>Dependencies between array jobs<a class="headerlink" href="#dependencies-between-array-jobs" title="Link to this heading"></a></h3>
<p>To handle dependencies between two or more array jobs one can use the
<code class="docutils literal notranslate"><span class="pre">--depend=aftercorr:&lt;previous</span> <span class="pre">job</span> <span class="pre">ID&gt;</span></code> (regular dependencies can also be used,
but we wanted to highlight this particular way since it can be beneficial with
array jobs), this will start the dependent array tasks as soon as the previous
corresponding array task has completed. E.g. if we start an array job with
<code class="docutils literal notranslate"><span class="pre">--array=1-5</span></code> and then start a second array job with <code class="docutils literal notranslate"><span class="pre">--array=1-5</span> <span class="pre">--depend=aftercorr:&lt;other</span> <span class="pre">job</span> <span class="pre">id&gt;</span></code>, once task <code class="docutils literal notranslate"><span class="pre">X</span></code> of the first job is complete
the second job will start its task <code class="docutils literal notranslate"><span class="pre">X</span></code>, independently of the other task in the
first or second job.</p>
</section>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<p>A small, but complete example (for a <code class="docutils literal notranslate"><span class="pre">normal</span></code> job on Saga):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=YourProject</span>
<span class="c1">#SBATCH --time=1:0:0</span>
<span class="c1">#SBATCH --mem-per-cpu=4G --ntasks=2</span>
<span class="c1">#SBATCH --array=1-200</span>

<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>errexit<span class="w"> </span><span class="c1"># exit on errors</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>nounset<span class="w"> </span><span class="c1"># treat unset variables as errors</span>
module<span class="w"> </span>--quiet<span class="w"> </span>purge<span class="w">   </span><span class="c1"># clear any inherited modules</span>

<span class="nv">DATASET</span><span class="o">=</span>dataset.<span class="nv">$SLURM_ARRAY_TASK_ID</span>
<span class="nv">OUTFILE</span><span class="o">=</span>result.<span class="nv">$SLURM_ARRAY_TASK_ID</span>

YourProgram<span class="w"> </span><span class="nv">$DATASET</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$OUTFILE</span>
</pre></div>
</div>
<p><a class="reference download internal" download="" href="../../_downloads/1128542edf572b203314b54d0dde3de2/minimal_array_job.sh"><code class="xref download docutils literal notranslate"><span class="pre">minimal_array_job.sh</span></code></a></p>
<p>Submit the script with <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">minimal_array_job.sh</span></code>. This job will process the
datasets <code class="docutils literal notranslate"><span class="pre">dataset.1</span></code>, <code class="docutils literal notranslate"><span class="pre">dataset.2</span></code>, …, <code class="docutils literal notranslate"><span class="pre">dataset.200</span></code> and put the results in
<code class="docutils literal notranslate"><span class="pre">result.1</span></code>, <code class="docutils literal notranslate"><span class="pre">result.2</span></code>, …, <code class="docutils literal notranslate"><span class="pre">result.200</span></code>. <strong>Note that your dataset files has to be named <code class="docutils literal notranslate"><span class="pre">dataset.1</span></code>, <code class="docutils literal notranslate"><span class="pre">dataset.2</span></code>, etc. for this example to work.</strong> Make sure that the names of your dataset files and the names in your script are the same. Each of the tasks will consist of
two processes (<code class="docutils literal notranslate"><span class="pre">--ntasks=2</span></code>) and get a total of <code class="docutils literal notranslate"><span class="pre">8GB</span></code> of memory (2 x
<code class="docutils literal notranslate"><span class="pre">--mem-per-cpu=4G</span></code>).</p>
<p>If your files has inconsistent naming (for example “dataset_one”, dataset_2”, “my_dataset” etc.), you either have to rename your files or include code in your script to handle your files. Here is one way to handle inconsistent names:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You need to have the same number of files in your dataset directory as the number of tasks you specify in the <code class="docutils literal notranslate"><span class="pre">--array</span></code> switch i.e. count the number of files in your dataset directory and use that number in the <code class="docutils literal notranslate"><span class="pre">--array</span></code> switch. For example, to check how many csv files are in the directory named data, use <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">data/*.csv</span> <span class="pre">|</span> <span class="pre">wc</span> <span class="pre">-l</span></code> in the terminal.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=YourProject</span>
<span class="c1">#SBATCH --time=1:0:0</span>
<span class="c1">#SBATCH --mem-per-cpu=4G --ntasks=2</span>
<span class="hll"><span class="c1">#SBATCH --array=0-199             # we start at 0 instead of 1 for this</span>
</span><span class="hll"><span class="w">                                  </span><span class="c1"># example, as the $SLURM_ARRAY_TASK_ID</span>
</span><span class="hll"><span class="w">                                  </span><span class="c1"># variable starts at 0</span>
</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>errexit<span class="w"> </span><span class="c1"># exit on errors</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>nounset<span class="w"> </span><span class="c1"># treat unset variables as errors</span>
module<span class="w"> </span>--quiet<span class="w"> </span>purge<span class="w">   </span><span class="c1"># clear any inherited modules</span>

<span class="nv">DATASETS</span><span class="o">=(</span>data/*<span class="o">)</span><span class="w">  </span><span class="c1"># get all files in the directory named &quot;data&quot;. Replace</span>
<span class="w">                   </span><span class="c1"># &quot;data&quot; with the path of your dataset directory.</span>

<span class="nv">FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">DATASETS</span><span class="p">[</span><span class="nv">$SLURM_ARRAY_TASK_ID</span><span class="p">]</span><span class="si">}</span>
<span class="nv">FILENAME</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">FILE</span><span class="p">%.*</span><span class="si">}</span><span class="k">)</span>

YourProgram<span class="w"> </span><span class="nv">$FILE</span><span class="w"> </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span>.out
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">DATASETS=(data/*)</span></code> will get all files in the directory named “data” and store them in an array. The array is indexed from 0, so the first file will be stored in <code class="docutils literal notranslate"><span class="pre">DATASETS[0]</span></code>, the second in <code class="docutils literal notranslate"><span class="pre">DATASETS[1]</span></code> and so on. The <code class="docutils literal notranslate"><span class="pre">SLURM_ARRAY_TASK_ID</span></code> variable is set by the Slurm system and is the task ID of the current task, with counting starting with 0.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If your datasets for example are csv files and the directory contains other file types, use DATASETS=(data/*.csv) instead.</p>
</div>
<p>Alternatively, you can save the names of you files in a text file and use the order of the filenames in the text file as an index. This is useful if you need the order of your files later or if you need to map the Slurm job output file to the correct dataset file.</p>
<p>Run for example these commands in the command line to create a text file with the names of your files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">DATASETS</span><span class="o">=(</span>data/*<span class="o">)</span>
<span class="gp">$ </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;%s\n&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">DATASETS</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>map_files.txt
</pre></div>
</div>
<p>And use the following example as you run script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=YourProject</span>
<span class="c1">#SBATCH --time=1:0:0</span>
<span class="c1">#SBATCH --mem-per-cpu=4G --ntasks=2</span>
<span class="c1">#SBATCH --array=0-199</span>

<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>errexit<span class="w"> </span><span class="c1"># exit on errors</span>
<span class="nb">set</span><span class="w"> </span>-o<span class="w"> </span>nounset<span class="w"> </span><span class="c1"># treat unset variables as errors</span>
module<span class="w"> </span>--quiet<span class="w"> </span>purge<span class="w">   </span><span class="c1"># clear any inherited modules</span>

<span class="nv">IDX</span><span class="o">=(</span><span class="nv">$SLURM_ARRAY_TASK_ID</span><span class="o">)</span>
<span class="nv">FILE</span><span class="o">=</span><span class="k">$(</span>sed<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IDX</span><span class="si">}</span><span class="s2">q;d&quot;</span><span class="w"> </span>map_files.txt<span class="k">)</span>
<span class="nv">FILENAME</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">FILE</span><span class="p">%.*</span><span class="si">}</span><span class="k">)</span>

YourProgram<span class="w"> </span><span class="nv">$FILE</span><span class="w"> </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">FILENAME</span><span class="si">}</span>.out
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can find a more extensive example <a class="reference internal" href="../guides/job_array_howto.html#job-array-howto"><span class="std std-ref">here</span></a>.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../choosing_job_types.html" class="btn btn-neutral float-left" title="Job Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../job_scripts.html" class="btn btn-neutral float-right" title="Job Scripts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>