

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to choose the right amount of memory &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/nris.css?v=69e7a171" />
      <link rel="stylesheet" type="text/css" href="../_static/universal-navbar.css" />
      <link rel="stylesheet" type="text/css" href="../_static/statuspal.css" />

  
    <link rel="shortcut icon" href="../_static/nris.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/statuspal_widget.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to choose the number of cores" href="choosing-number-of-cores.html" />
    <link rel="prev" title="Understanding the job output file" href="slurm_output.html" /> 
</head>

<body class="wy-body-for-nav">
<!-- Send url to parent when displayed as iframe -->
<script>
    const valid_orign_url = "https://www.sigma2.no"
    window.addEventListener('message', function(event) {
        if (event.data === 'getDocumentationIframeUrl' && event.origin.startsWith(valid_orign_url)) {
            // path only (/path/example.html)
            const path = window.location.pathname
            // query string (including the initial ? symbol)
            const search = window.location.search
            // Returns the hash (including the initial # symbol)
            const hash = window.location.hash
            const newUrl = path + search + hash;
            event.source.postMessage(newUrl, event.origin)
        }
    })

</script>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/two_factor_authentication.html">One-time-pad (OTP) / Two-factor authentication</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.sigma2.no/project-leader-handbook">Project Leader Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../training/events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/past_training.html">An overview over training events in the past</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/short_instructions.html">Short Instructions Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training/material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/opslog.html">Status and maintenance of systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_development/guides/vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ssh.html#common-ssh-errors">Common SSH errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ood.html">Open OnDemand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../files_storage/performance.html">Optimizing storage performance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="overview.html">Running jobs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="submitting.html">Submitting jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="choosing_job_types.html">Job Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="job_scripts/array_jobs.html">Array Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="job_scripts.html">Job Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="monitoring.html">Monitoring jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="slurm_output.html">Understanding the job output file</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to choose the right amount of memory</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#why-it-matters">Why it matters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-a-test-job-before-running-many-similar-jobs">Run a test job before running many similar jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-get-more-memory-if-you-need-it">How to get more memory if you need it</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-find-out-how-much-memory-you-need">How to find out how much memory you need</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-code-which-you-can-use-for-testing-this">Example code which you can use for testing this</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-top">Using top</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-checking-the-slurm-output-generated-with-your-job">By checking the Slurm output generated with your job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-using-sacct">By using sacct</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-jobstats">Using jobstats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-seff">Using seff</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-prepending-your-binary-with-usr-bin-time-v">By prepending your binary with /usr/bin/time -v</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-using-arm-performance-reports">By using Arm Performance Reports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-reducing-the-memory-parameter-until-a-job-fails">By reducing the memory parameter until a job fails</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="choosing-number-of-cores.html">How to choose the number of cores</a></li>
<li class="toctree-l2"><a class="reference internal" href="common_job_failures.html">Common job failures</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">How to check the performance and scaling using Arm Performance Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="mkl.html">Using MKL efficiently</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory-bandwidth.html">Efficient use of memory bandwidth on Betzy</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel-calculations.html">Efficient use of processors and network on Betzy</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive_jobs.html">Interactive jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkpointing.html">Checkpointing Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="projects_accounting.html">Projects and accounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="scratchfiles.html">Local storage for scratch files</a></li>
<li class="toctree-l2"><a class="reference internal" href="guides.html">Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="slurm_commands.html">Useful Slurm commands and tools for managing jobs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internet-login-compute-nodes.html">Login nodes:</a></li>
<li class="toctree-l1"><a class="reference internal" href="internet-login-compute-nodes.html#compute-nodes">Compute nodes:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computing/tuning-applications.html">Tuning applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_development/guides_llm.html">Running LLM Models in a Cluster Environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compute resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/hardware_overview.html">Overview over our machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/betzy.html">Betzy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/fram.html">Fram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/olivia.html">Olivia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/saga.html">Saga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc_machines/lumi.html">LUMI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software/modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/licenses.html">Licence and access policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software/eessi.html">EESSI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../nird_archive/sandbox-user-guide.html">NIRD Research Data Archive Sandbox (NIRD RDA sandbox)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nird_archive/user-guide.html">NIRD Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nird_service_platform/overview_nird_service_platform.html">NIRD Service Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../code_development/overview.html">Code development and tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="overview.html">Running jobs</a></li>
      <li class="breadcrumb-item active">How to choose the right amount of memory</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-choose-the-right-amount-of-memory">
<span id="choosing-memory-settings"></span><h1><a class="toc-backref" href="#id1" role="doc-backlink">How to choose the right amount of memory</a><a class="headerlink" href="#how-to-choose-the-right-amount-of-memory" title="Link to this heading"></a></h1>
<div class="admonition-do-not-ask-for-a-lot-more-memory-than-you-need admonition">
<p class="admonition-title">Do not ask for a lot more memory than you need</p>
<p>A job that asks for many CPUs but little memory will be billed
for its number of CPUs, while a job that asks for a lot of memory but
few CPUs, may be billed for its memory requirement.</p>
<p>If you ask for a lot more memory than you need:</p>
<ul class="simple">
<li><p>You might be surprised that your job will bill your project a lot more than
you expected.</p></li>
<li><p>Your job may queue much longer than it would asking for less memory.</p></li>
<li><p>The possibility to parallelize your job/workflow may be more limited.</p></li>
</ul>
</div>
<nav class="contents" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-choose-the-right-amount-of-memory" id="id1">How to choose the right amount of memory</a></p>
<ul>
<li><p><a class="reference internal" href="#why-it-matters" id="id2">Why it matters</a></p></li>
<li><p><a class="reference internal" href="#run-a-test-job-before-running-many-similar-jobs" id="id3">Run a test job before running many similar jobs</a></p></li>
<li><p><a class="reference internal" href="#how-to-get-more-memory-if-you-need-it" id="id4">How to get more memory if you need it</a></p></li>
<li><p><a class="reference internal" href="#how-to-find-out-how-much-memory-you-need" id="id5">How to find out how much memory you need</a></p>
<ul>
<li><p><a class="reference internal" href="#example-code-which-you-can-use-for-testing-this" id="id6">Example code which you can use for testing this</a></p></li>
<li><p><a class="reference internal" href="#using-top" id="id7">Using top</a></p></li>
<li><p><a class="reference internal" href="#by-checking-the-slurm-output-generated-with-your-job" id="id8">By checking the Slurm output generated with your job</a></p></li>
<li><p><a class="reference internal" href="#by-using-sacct" id="id9">By using sacct</a></p></li>
<li><p><a class="reference internal" href="#using-jobstats" id="id10">Using jobstats</a></p></li>
<li><p><a class="reference internal" href="#using-seff" id="id11">Using seff</a></p></li>
<li><p><a class="reference internal" href="#by-prepending-your-binary-with-usr-bin-time-v" id="id12">By prepending your binary with /usr/bin/time -v</a></p></li>
<li><p><a class="reference internal" href="#by-using-arm-performance-reports" id="id13">By using Arm Performance Reports</a></p></li>
<li><p><a class="reference internal" href="#by-reducing-the-memory-parameter-until-a-job-fails" id="id14">By reducing the memory parameter until a job fails</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="why-it-matters">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Why it matters</a><a class="headerlink" href="#why-it-matters" title="Link to this heading"></a></h2>
<p>Please read the above box, please share this with your colleagues and students.
A significant portion of resources risks to be wasted if you ask for too much memory.</p>
<p>This is because memory and CPU are not completely independent. If I ask for too
much memory, I also block the compute resources which carry that memory
resource at the same time.</p>
<p>A too generous “better safe than sorry” approach to memory allocation leads to these problems:</p>
<ul class="simple">
<li><p>Your compute account <strong>gets charged too much</strong> (problem for you and your
allocation group, as well as for the tax payer financing these compute
resources)</p></li>
<li><p>Other users have to <strong>wait longer with their jobs</strong> (problem for us and for other users)</p></li>
<li><p>Your <strong>jobs may queue much longer</strong> (problem for you) because the scheduler does
not know that you might use a lot less memory than you ask it to reserve for you</p></li>
<li><p>The <strong>possibility to parallelize your job/workflow may be severely limited</strong> if
you ask for excessive amount of unused memory since there may not be enough
memory left for parallel jobs running at the same time</p></li>
</ul>
<p>It is important to make sure that your jobs use the right amount of memory
(below we show how to find out) and <a class="reference internal" href="choosing-number-of-cores.html#choosing-number-of-cores"><span class="std std-ref">the right number of CPUs</span></a> in order to help you and others using the HPC
machines utilize these resources more efficiently, and in turn get work done
more speedily.</p>
<p>If you ask for too little memory, your job will be stopped and it might be
stopped late in the run.</p>
</section>
<section id="run-a-test-job-before-running-many-similar-jobs">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Run a test job before running many similar jobs</a><a class="headerlink" href="#run-a-test-job-before-running-many-similar-jobs" title="Link to this heading"></a></h2>
<p>We recommend users to run a test job before submitting many similar runs to the
queue system and find out how much memory is used (see below for examples on
how to do that).  <strong>Once you know, add perhaps 15-20% extra memory</strong> (and runtime)
for the job compared to what your representative test case needed.</p>
<p>Remember to check the <a class="reference external" href="https://slurm.schedmd.com/squeue.html#lbAG">Slurm documentation</a>,
<a class="reference internal" href="choosing_job_types.html"><span class="std std-doc">job types</span></a>,
<a class="reference internal" href="submitting/queue_system_concepts.html"><span class="std std-doc">queue system concepts</span></a>,
and <a class="reference internal" href="../hpc_machines/hardware_overview.html"><span class="std std-doc">HPC machines</span></a>
to verify that you are submitting the right job to the right partition and
right hardware.</p>
</section>
<section id="how-to-get-more-memory-if-you-need-it">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">How to get more memory if you need it</a><a class="headerlink" href="#how-to-get-more-memory-if-you-need-it" title="Link to this heading"></a></h2>
<p>Speaking of right partition, one way to get more memory if a node is not enough
is to spread the job over several nodes by asking for more cores than needed.
But this comes at the price of paying for more resources, queuing longer, and
possibly blocking others.  A good alternative for jobs that need a lot of memory
is often to get access to “highmem” nodes which are designed for jobs with high
memory demand.</p>
</section>
<section id="how-to-find-out-how-much-memory-you-need">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">How to find out how much memory you need</a><a class="headerlink" href="#how-to-find-out-how-much-memory-you-need" title="Link to this heading"></a></h2>
<section id="example-code-which-you-can-use-for-testing-this">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Example code which you can use for testing this</a><a class="headerlink" href="#example-code-which-you-can-use-for-testing-this" title="Link to this heading"></a></h3>
<p>You can test some of the approaches with the following example code (<code class="docutils literal notranslate"><span class="pre">example.f90</span></code>)
which allocates 3210 MB (you can adapt that value if you want it to consume
more or less memory):</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">example</span>

<span class="w">    </span><span class="k">implicit none</span>

<span class="hll"><span class="k">    </span><span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">size_mb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3210</span>
</span><span class="w">    </span><span class="kt">integer</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">size_mw</span>
<span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">a</span><span class="p">(:)</span>

<span class="c">!   print *, &#39;will try to allocate&#39;, size_mb, &#39;MB&#39;</span>

<span class="w">    </span><span class="n">size_mw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">1000000</span><span class="o">*</span><span class="n">size_mb</span><span class="o">/</span><span class="mf">7.8125d0</span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">size_mw</span><span class="p">))</span>

<span class="w">    </span><span class="c">! this is here so that the allocated memory gets actually used and the</span>
<span class="w">    </span><span class="c">! compiler does not skip allocating the array</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0d0</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;first element:&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="w">    </span><span class="c">! wait for 35 seconds</span>
<span class="w">    </span><span class="c">! because slurm only samples every 30 seconds</span>
<span class="w">    </span><span class="k">call </span><span class="nb">sleep</span><span class="p">(</span><span class="mi">35</span><span class="p">)</span>

<span class="w">    </span><span class="k">deallocate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="w">    </span><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ok all went well&#39;</span>

<span class="k">end program</span>
</pre></div>
</div>
<p>Compile it like this and later we can examine <code class="docutils literal notranslate"><span class="pre">mybinary</span></code> and check whether we can find out that
it really allocated 3210 MB:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>gfortran<span class="w"> </span>example.f90<span class="w"> </span>-o<span class="w"> </span>mybinary
</pre></div>
</div>
</section>
<section id="using-top">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Using top</a><a class="headerlink" href="#using-top" title="Link to this heading"></a></h3>
<p>While the job is running, find out on which node(s) it runs using <code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">--me</span></code>,
then <code class="docutils literal notranslate"><span class="pre">ssh</span></code> into one of the listed compute nodes and run <code class="docutils literal notranslate"><span class="pre">top</span> <span class="pre">-u</span> <span class="pre">$USER</span></code>. See <a class="reference internal" href="monitoring/squeue.html#squeue"><span class="std std-ref">squeue output examples</span></a> for further reference on <code class="docutils literal notranslate"><span class="pre">squeue</span></code></p>
</section>
<section id="by-checking-the-slurm-output-generated-with-your-job">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">By checking the Slurm output generated with your job</a><a class="headerlink" href="#by-checking-the-slurm-output-generated-with-your-job" title="Link to this heading"></a></h3>
<p>We can use the following example script (adapt <code class="docutils literal notranslate"><span class="pre">--account=nn____k</span></code>; this is tested on Saga):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="hll"><span class="c1">#SBATCH --account=nn____k</span>
</span>
<span class="c1">#SBATCH --job-name=&#39;mem-profiling&#39;</span>
<span class="c1">#SBATCH --time=0-00:01:30</span>
<span class="c1">#SBATCH --mem-per-cpu=3500M</span>
<span class="c1">#SBATCH --ntasks=1</span>

<span class="c1"># we could also compile it outside of the job script</span>
<span class="n">gfortran</span> <span class="n">example</span><span class="o">.</span><span class="n">f90</span> <span class="o">-</span><span class="n">o</span> <span class="n">mybinary</span>

<span class="o">./</span><span class="n">mybinary</span>
</pre></div>
</div>
<p>Slurm generates an output for each job you run. For instance job number <code class="docutils literal notranslate"><span class="pre">10404698</span></code>
generated output <code class="docutils literal notranslate"><span class="pre">slurm-10404698.out</span></code>.</p>
<p>This output contains the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Submitted</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span><span class="n">T13</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">03</span><span class="p">;</span> <span class="n">waited</span> <span class="mf">27.0</span> <span class="n">seconds</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">queue</span> <span class="n">after</span> <span class="n">becoming</span> <span class="n">eligible</span> <span class="n">to</span> <span class="n">run</span><span class="o">.</span>

<span class="n">Requested</span> <span class="n">wallclock</span> <span class="n">time</span><span class="p">:</span> <span class="mf">2.0</span> <span class="n">minutes</span>
<span class="n">Elapsed</span> <span class="n">wallclock</span> <span class="n">time</span><span class="p">:</span>   <span class="mf">44.0</span> <span class="n">seconds</span>

<span class="n">Task</span> <span class="ow">and</span> <span class="n">CPU</span> <span class="n">statistics</span><span class="p">:</span>
<span class="n">ID</span>              <span class="n">CPUs</span>  <span class="n">Tasks</span>  <span class="n">CPU</span> <span class="n">util</span>                <span class="n">Start</span>  <span class="n">Elapsed</span>  <span class="n">Exit</span> <span class="n">status</span>
<span class="mi">10404698</span>           <span class="mi">1</span>            <span class="mf">0.0</span> <span class="o">%</span>  <span class="mi">2024</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span><span class="n">T13</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">30</span>   <span class="mf">44.0</span> <span class="n">s</span>  <span class="mi">0</span>
<span class="mf">10404698.</span><span class="n">batch</span>     <span class="mi">1</span>      <span class="mi">1</span>     <span class="mf">2.7</span> <span class="o">%</span>  <span class="mi">2024</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span><span class="n">T13</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">30</span>   <span class="mf">44.0</span> <span class="n">s</span>  <span class="mi">0</span>

<span class="n">Used</span> <span class="n">CPU</span> <span class="n">time</span><span class="p">:</span>   <span class="mf">1.2</span> <span class="n">CPU</span> <span class="n">seconds</span>
<span class="n">Unused</span> <span class="n">CPU</span> <span class="n">time</span><span class="p">:</span> <span class="mf">42.8</span> <span class="n">CPU</span> <span class="n">seconds</span>

<span class="hll"><span class="n">Memory</span> <span class="n">statistics</span><span class="p">,</span> <span class="ow">in</span> <span class="n">GiB</span><span class="p">:</span>
</span><span class="n">ID</span>               <span class="n">Alloc</span>   <span class="n">Usage</span>
<span class="mi">10404698</span>           <span class="mf">3.4</span>
<span class="hll"><span class="mf">10404698.</span><span class="n">batch</span>     <span class="mf">3.4</span>     <span class="mf">3.1</span>
</span></pre></div>
</div>
<p>From this (see below <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">statistics</span></code>) we can find out that the job used 3.1
GiB memory.</p>
<p>Note that <strong>Slurm samples the memory every 30 seconds</strong>. This means that if your
job is shorter than 30 seconds, it will show that your calculation consumed
zero memory which is probably wrong.  The sampling rate also means that if your
job contains short peaks of high memory consumption, the sampling may
miss these.</p>
<section id="slurm-reports-values-for-each-job-step">
<h4>Slurm reports values for each job step<a class="headerlink" href="#slurm-reports-values-for-each-job-step" title="Link to this heading"></a></h4>
<p>If you call <code class="docutils literal notranslate"><span class="pre">srun</span></code> or <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> multiple times in your job script they will get
one line each in the <code class="docutils literal notranslate"><span class="pre">sacct</span></code> output with separate entries for both <code class="docutils literal notranslate"><span class="pre">AvgRSS</span></code> and
<code class="docutils literal notranslate"><span class="pre">MaxRSS</span></code>.</p>
<p>Also the job script itself (commands run in the jobscript without using <code class="docutils literal notranslate"><span class="pre">srun</span></code>
or <code class="docutils literal notranslate"><span class="pre">mpirun</span></code>) is counted as a <em>step</em>, called the <code class="docutils literal notranslate"><span class="pre">batch</span></code> step.</p>
</section>
</section>
<section id="by-using-sacct">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">By using sacct</a><a class="headerlink" href="#by-using-sacct" title="Link to this heading"></a></h3>
<p>This creates a short version of the above.</p>
<p>As an example, I want to know this for my job which had the number <code class="docutils literal notranslate"><span class="pre">10404698</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sacct<span class="w"> </span>-j<span class="w"> </span><span class="m">10404698</span><span class="w"> </span>--format<span class="o">=</span>MaxRSS

<span class="go">    MaxRSS</span>
<span class="go">----------</span>

<span class="go">  3210588K</span>
<span class="go">         0</span>
</pre></div>
</div>
<p>From this we see that the job needed <code class="docutils literal notranslate"><span class="pre">3210588K</span></code> memory, same as above. The
comment above about possibly multiple steps applies also here.</p>
</section>
<section id="using-jobstats">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Using jobstats</a><a class="headerlink" href="#using-jobstats" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">jobstats</span></code> is always run as part of your job output. But knowing that the
command exists also on its own can be useful if you still know/remember the job
number (here: 10404698) but you have lost the Slurm output.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>jobstats<span class="w"> </span>-j<span class="w"> </span><span class="m">10404698</span>
<span class="go">Job 10404698 consumed 0.0 billing hours from project nn****k.</span>

<span class="go">Submitted 2024-02-04T13:11:03; waited 27.0 seconds in the queue after becoming eligible to run.</span>

<span class="go">Requested wallclock time: 2.0 minutes</span>
<span class="go">Elapsed wallclock time:   44.0 seconds</span>

<span class="go">Task and CPU statistics:</span>
<span class="go">ID              CPUs  Tasks  CPU util                Start  Elapsed  Exit status</span>
<span class="go">10404698           1            0.0 %  2024-02-04T13:11:30   44.0 s  0</span>
<span class="go">10404698.batch     1      1     2.7 %  2024-02-04T13:11:30   44.0 s  0</span>

<span class="go">Used CPU time:   1.2 CPU seconds</span>
<span class="go">Unused CPU time: 42.8 CPU seconds</span>

<span class="go">Memory statistics, in GiB:</span>
<span class="go">ID               Alloc   Usage</span>
<span class="go">10404698           3.4</span>
<span class="go">10404698.batch     3.4     3.1</span>
</pre></div>
</div>
</section>
<section id="using-seff">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Using seff</a><a class="headerlink" href="#using-seff" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">seff</span></code> is a nice tool which we can use on <strong>completed jobs</strong>. For example here we ask
for a summary for the job number 10404698:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>seff<span class="w"> </span><span class="m">10404698</span>

<span class="go">Job ID: 10404698</span>
<span class="go">Cluster: saga</span>
<span class="go">User/Group: someuser/someuser</span>
<span class="go">State: COMPLETED (exit code 0)</span>
<span class="go">Cores: 1</span>
<span class="go">CPU Utilized: 00:00:01</span>
<span class="go">CPU Efficiency: 2.27% of 00:00:44 core-walltime</span>
<span class="go">Job Wall-clock time: 00:00:44</span>
<span class="hll"><span class="go">Memory Utilized: 3.06 GB</span>
</span><span class="hll"><span class="go">Memory Efficiency: 89.58% of 3.42 GB</span>
</span></pre></div>
</div>
</section>
<section id="by-prepending-your-binary-with-usr-bin-time-v">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">By prepending your binary with /usr/bin/time -v</a><a class="headerlink" href="#by-prepending-your-binary-with-usr-bin-time-v" title="Link to this heading"></a></h3>
<p>In your job script instead of running <code class="docutils literal notranslate"><span class="pre">./mybinary</span></code> directly, prepend it with <code class="docutils literal notranslate"><span class="pre">/usr/bin/time</span> <span class="pre">-v</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="c1">#SBATCH --account=nn____k</span>

<span class="c1">#SBATCH --job-name=&#39;mem-profiling&#39;</span>
<span class="c1">#SBATCH --time=0-00:01:30</span>
<span class="c1">#SBATCH --mem-per-cpu=3500M</span>
<span class="c1">#SBATCH --ntasks=1</span>

<span class="c1"># instead of this:</span>
<span class="c1"># ./mybinary</span>

<span class="c1"># we do this:</span>
<span class="hll"><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">time</span> <span class="o">-</span><span class="n">v</span> <span class="o">./</span><span class="n">mybinary</span>
</span></pre></div>
</div>
<p>Then in the Slurm output we find:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Command</span> <span class="n">being</span> <span class="n">timed</span><span class="p">:</span> <span class="s2">&quot;./mybinary&quot;</span>
<span class="n">User</span> <span class="n">time</span> <span class="p">(</span><span class="n">seconds</span><span class="p">):</span> <span class="mf">0.51</span>
<span class="n">System</span> <span class="n">time</span> <span class="p">(</span><span class="n">seconds</span><span class="p">):</span> <span class="mf">0.64</span>
<span class="n">Percent</span> <span class="n">of</span> <span class="n">CPU</span> <span class="n">this</span> <span class="n">job</span> <span class="n">got</span><span class="p">:</span> <span class="mi">3</span><span class="o">%</span>
<span class="n">Elapsed</span> <span class="p">(</span><span class="n">wall</span> <span class="n">clock</span><span class="p">)</span> <span class="n">time</span> <span class="p">(</span><span class="n">h</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ss</span> <span class="ow">or</span> <span class="n">m</span><span class="p">:</span><span class="n">ss</span><span class="p">):</span> <span class="mi">0</span><span class="p">:</span><span class="mf">36.16</span>
<span class="n">Average</span> <span class="n">shared</span> <span class="n">text</span> <span class="n">size</span> <span class="p">(</span><span class="n">kbytes</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">unshared</span> <span class="n">data</span> <span class="n">size</span> <span class="p">(</span><span class="n">kbytes</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">stack</span> <span class="n">size</span> <span class="p">(</span><span class="n">kbytes</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">total</span> <span class="n">size</span> <span class="p">(</span><span class="n">kbytes</span><span class="p">):</span> <span class="mi">0</span>
<span class="hll"><span class="n">Maximum</span> <span class="n">resident</span> <span class="nb">set</span> <span class="n">size</span> <span class="p">(</span><span class="n">kbytes</span><span class="p">):</span> <span class="mi">3212160</span>
</span><span class="n">Average</span> <span class="n">resident</span> <span class="nb">set</span> <span class="n">size</span> <span class="p">(</span><span class="n">kbytes</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Major</span> <span class="p">(</span><span class="n">requiring</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="p">)</span> <span class="n">page</span> <span class="n">faults</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Minor</span> <span class="p">(</span><span class="n">reclaiming</span> <span class="n">a</span> <span class="n">frame</span><span class="p">)</span> <span class="n">page</span> <span class="n">faults</span><span class="p">:</span> <span class="mi">2394</span>
<span class="n">Voluntary</span> <span class="n">context</span> <span class="n">switches</span><span class="p">:</span> <span class="mi">20</span>
<span class="n">Involuntary</span> <span class="n">context</span> <span class="n">switches</span><span class="p">:</span> <span class="mi">41</span>
<span class="n">Swaps</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">File</span> <span class="n">system</span> <span class="n">inputs</span><span class="p">:</span> <span class="mi">57</span>
<span class="n">File</span> <span class="n">system</span> <span class="n">outputs</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Socket</span> <span class="n">messages</span> <span class="n">sent</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Socket</span> <span class="n">messages</span> <span class="n">received</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Signals</span> <span class="n">delivered</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Page</span> <span class="n">size</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">):</span> <span class="mi">4096</span>
<span class="n">Exit</span> <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<p>The relevant information in this context is <code class="docutils literal notranslate"><span class="pre">Maximum</span> <span class="pre">resident</span> <span class="pre">set</span> <span class="pre">size</span> <span class="pre">(kbytes)</span></code>, in this case 3210916 kB which is what we expected to find.  Note
that it has to be <code class="docutils literal notranslate"><span class="pre">/usr/bin/time</span> <span class="pre">-v</span></code> and <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">-v</span></code> alone will not do it.</p>
</section>
<section id="by-using-arm-performance-reports">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">By using Arm Performance Reports</a><a class="headerlink" href="#by-using-arm-performance-reports" title="Link to this heading"></a></h3>
<p>You can profile your job using <a class="reference internal" href="performance.html#arm-performance-reports"><span class="std std-ref">Arm Performance Reports</span></a>.</p>
<p>Here is an example script (adapt <code class="docutils literal notranslate"><span class="pre">--account=nn____k</span></code>; this is tested on Saga):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/env/bin bash</span>

<span class="c1">#SBATCH --account=nn____k</span>
<span class="c1">#SBATCH --qos=devel</span>

<span class="c1">#SBATCH --job-name=&#39;mem-profiling&#39;</span>
<span class="c1">#SBATCH --time=0-00:01:00</span>
<span class="c1">#SBATCH --mem-per-cpu=3500M</span>
<span class="c1">#SBATCH --ntasks=1</span>

<span class="hll"><span class="n">module</span> <span class="n">purge</span>
</span><span class="hll"><span class="n">module</span> <span class="n">load</span> <span class="n">Arm</span><span class="o">-</span><span class="n">Forge</span><span class="o">/</span><span class="mf">22.1.3</span>
</span>
<span class="hll"><span class="n">perf</span><span class="o">-</span><span class="n">report</span> <span class="o">./</span><span class="n">mybinary</span>
</span></pre></div>
</div>
<p>This generates a HTML and text summary. These reports contain lots of
interesting information. Here showing the relevant part of the text report for
the memory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Memory</span><span class="p">:</span>
<span class="n">Per</span><span class="o">-</span><span class="n">process</span> <span class="n">memory</span> <span class="n">usage</span> <span class="n">may</span> <span class="n">also</span> <span class="n">affect</span> <span class="n">scaling</span><span class="p">:</span>
<span class="n">Mean</span> <span class="n">process</span> <span class="n">memory</span> <span class="n">usage</span><span class="p">:</span>                    <span class="mf">1.39</span> <span class="n">GiB</span>
<span class="hll"><span class="n">Peak</span> <span class="n">process</span> <span class="n">memory</span> <span class="n">usage</span><span class="p">:</span>                    <span class="mf">3.07</span> <span class="n">GiB</span>
</span><span class="n">Peak</span> <span class="n">node</span> <span class="n">memory</span> <span class="n">usage</span><span class="p">:</span>                      <span class="mf">27.0</span><span class="o">%</span> <span class="o">|==|</span>
</pre></div>
</div>
</section>
<section id="by-reducing-the-memory-parameter-until-a-job-fails">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">By reducing the memory parameter until a job fails</a><a class="headerlink" href="#by-reducing-the-memory-parameter-until-a-job-fails" title="Link to this heading"></a></h3>
<p>This is not an elegant approach but can be an OK approach to calibrate one
script before submitting 300 similar jobs.</p>
<p>What you can do is to start with a generous memory setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#SBATCH --mem-per-cpu=3500M</span>
</pre></div>
</div>
<p>And gradually reduce it until your job fails with <code class="docutils literal notranslate"><span class="pre">oom-kill</span></code> (”<strong>oom</strong>” or “<strong>OOM</strong>” is short for “out of memory”):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slurmstepd</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Detected</span> <span class="mi">1</span> <span class="n">oom_kill</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">StepId</span><span class="o">=</span><span class="mf">10404708.</span><span class="n">batch</span><span class="o">.</span>
<span class="n">Some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">step</span> <span class="n">tasks</span> <span class="n">have</span> <span class="n">been</span> <span class="n">OOM</span> <span class="n">Killed</span><span class="o">.</span>
</pre></div>
</div>
<p>Or you start with a very conservative estimate and you gradually increase until
the job is not stopped.</p>
<p>Then you also know. But there are more elegant ways to figure this out (see
options above).</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="slurm_output.html" class="btn btn-neutral float-left" title="Understanding the job output file" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="choosing-number-of-cores.html" class="btn btn-neutral float-right" title="How to choose the number of cores" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>