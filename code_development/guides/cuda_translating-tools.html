

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Translating GPU-accelerated applications &mdash; Sigma2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/nris.css?v=69e7a171" />
      <link rel="stylesheet" type="text/css" href="../../_static/universal-navbar.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/statuspal.css" />

  
    <link rel="shortcut icon" href="../../_static/nris.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://siteimproveanalytics.com/js/siteanalyze_6036825.js"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../_static/statuspal_widget.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">
<!-- Send url to parent when displayed as iframe -->
<script>
    const valid_orign_url = "https://www.sigma2.no"
    window.addEventListener('message', function(event) {
        if (event.data === 'getDocumentationIframeUrl' && event.origin.startsWith(valid_orign_url)) {
            // path only (/path/example.html)
            const path = window.location.pathname
            // query string (including the initial ? symbol)
            const search = window.location.search
            // Returns the hash (including the initial # symbol)
            const hash = window.location.hash
            const newUrl = path + search + hash;
            event.source.postMessage(newUrl, event.origin)
        }
    })

</script>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Sigma2/NRIS documentation
              <img src="../../_static/NRIS Logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Policies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code-of-conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/support_line.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/extended_support.html">Extended support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/how_to_write_good_support_requests.html">Writing good support requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/qa-sessions.html">Open Question &amp; Answer Sessions for All Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/lost_forgotten_password.html">Lost, expiring or changing passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/two_factor_authentication.html">One-time-pad (OTP) / Two-factor authentication</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.sigma2.no/project-leader-handbook">Project Leader Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Training</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../training/events.html">Training events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/notes_qa.html">Questions, Answers and Feedbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/past_training.html">An overview over training events in the past</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/videos.html">Training Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/short_instructions.html">Short Instructions Video Archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training/material.html">Training materials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/opslog.html">Status and maintenance of systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/applying_account.html">How do I get an account?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/applying_resources.html">Applying for computing and storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/file_transfer.html">File transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/editing_files.html">Editing files</a></li>
<li class="toctree-l1"><a class="reference internal" href="vs_code/connect_to_server.html">Connecting to a system with Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/ssh.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/ssh.html#common-ssh-errors">Common SSH errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/ood.html">Open OnDemand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/R.html">First R calculation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Files, storage and backup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/nird_lmd.html">NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/clusters.html">Storage areas on HPC clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/quota.html">Storage quota</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/backup.html">Backup on Betzy, Fram, Saga, and NIRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/sharing_files.html">Data handling and storage policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../files_storage/performance.html">Optimizing storage performance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">HPC usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/migration2metacenter.html">Migration to an NRIS HPC machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/responsible-use.html">Using shared resources responsibly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/overview.html">Running jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/internet-login-compute-nodes.html">Login nodes:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jobs/internet-login-compute-nodes.html#compute-nodes">Compute nodes:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../computing/tuning-applications.html">Tuning applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides_llm.html">Running LLM Models in a Cluster Environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compute resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/hardware_overview.html">Overview over our machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/betzy.html">Betzy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/fram.html">Fram</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/olivia.html">Olivia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/saga.html">Saga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc_machines/lumi.html">LUMI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../software/modulescheme.html">Software module scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/installed_software.html">Installed software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/userinstallsw.html">Installing software as user</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/appguides.html">Application guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/licenses.html">Licence and access policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software/eessi.html">EESSI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional services</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../nird_archive/sandbox-user-guide.html">NIRD Research Data Archive Sandbox (NIRD RDA sandbox)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nird_archive/user-guide.html">NIRD Research Data Archive (NIRD RDA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nird_toolkit/overview.html">NIRD Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nird_service_platform/overview_nird_service_platform.html">NIRD Service Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/easydmp-user-documentation.html">EasyDMP User Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_help/course_resources.html">CRaaS - Course Resources as a Service</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code development and tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Code development and tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Sigma2/NRIS documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Translating GPU-accelerated applications</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="translating-gpu-accelerated-applications">
<span id="cuda2hip0sycl"></span><h1><a class="toc-backref" href="#id2" role="doc-backlink">Translating GPU-accelerated applications</a><a class="headerlink" href="#translating-gpu-accelerated-applications" title="Link to this heading"></a></h1>
<p>We present different tools to translate CUDA and OpenACC applications to target various GPU (Graphics Processing Unit) architectures (e.g. AMD and Intel GPUs). A special focus will be given to <a class="reference external" href="https://docs.amd.com/en-US/bundle/HIPify-Reference-Guide-v5.1/page/HIPify.html"><code class="docutils literal notranslate"><span class="pre">hipify</span></code></a>, <a class="reference external" href="https://www.intel.com/content/www/us/en/developer/articles/technical/syclomatic-new-cuda-to-sycl-code-migration-tool.html#gs.o5pj6f"><code class="docutils literal notranslate"><span class="pre">syclomatic</span></code></a> and <a class="reference external" href="https://csmd.ornl.gov/project/clacc"><code class="docutils literal notranslate"><span class="pre">clacc</span></code></a>. These tools have been tested on the supercomputer <a class="reference external" href="https://lumi-supercomputer.eu/lumi_supercomputer/">LUMI-G</a> in which the GPU partitions are of <a class="reference external" href="https://www.amd.com/en/products/server-accelerators/instinct-mi250x">AMD MI250X GPU</a> type.</p>
<p>The aim of this tutorial is to guide users through a straightforward procedure for converting CUDA codes to HIP and SYCL, and OpenACC codes to OpenMP offloading. By the end of this tutorial, we expect users to learn about:</p>
<ul class="simple">
<li><p>How to use the <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code> and <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> tools to translate CUDA sources to HIP sources.</p></li>
<li><p>How to use the <code class="docutils literal notranslate"><span class="pre">syclomatic</span></code> tool to convert CUDA source to SYCL.</p></li>
<li><p>How to use the <code class="docutils literal notranslate"><span class="pre">clacc</span></code> tool to convert OpenACC application to OpenMP offloading.</p></li>
<li><p>How to compile the generated HIP, SYCL and OpenMP applications.</p></li>
</ul>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#translating-gpu-accelerated-applications" id="id2">Translating GPU-accelerated applications</a></p>
<ul>
<li><p><a class="reference internal" href="#translating-cuda-to-hip-with-hipify" id="id3">Translating CUDA to HIP with Hipify</a></p></li>
<li><p><a class="reference internal" href="#translating-cuda-to-sycl-with-syclomatic" id="id4">Translating CUDA to SYCL with Syclomatic</a></p></li>
<li><p><a class="reference internal" href="#translate-openacc-to-openmp-with-clacc" id="id5">Translate OpenACC to OpenMP with Clacc</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#conclusion" id="id6">Conclusion</a></p></li>
<li><p><a class="reference internal" href="#relevant-links" id="id7">Relevant links</a></p></li>
</ul>
</nav>
<section id="translating-cuda-to-hip-with-hipify">
<span id="cuda2hip"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">Translating CUDA to HIP with Hipify</a><a class="headerlink" href="#translating-cuda-to-hip-with-hipify" title="Link to this heading"></a></h2>
<p>In this section, we cover the use of <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code> and <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> tools to translate a CUDA application to HIP.</p>
<section id="hipify-perl">
<h3>Hipify-perl<a class="headerlink" href="#hipify-perl" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code> tool is a script based on perl that translates CUDA syntax into HIP syntax (see .e.g. <a class="reference external" href="https://docs.amd.com/en-US/bundle/HIPify-Reference-Guide-v5.1/page/HIPify.html#perl">here</a>. As an example, in a CUDA code that makes use of the CUDA functions <code class="docutils literal notranslate"><span class="pre">cudaMalloc</span></code> and <code class="docutils literal notranslate"><span class="pre">cudaDeviceSynchronize</span></code>, the tool will replace <code class="docutils literal notranslate"><span class="pre">cudaMalloc</span></code> by the HIP function <code class="docutils literal notranslate"><span class="pre">hipMalloc</span></code>. Similarly for the CUDA function <code class="docutils literal notranslate"><span class="pre">cudaDeviceSynchronize</span></code>, which will be replaced by <code class="docutils literal notranslate"><span class="pre">hipDeviceSynchronize</span></code>. We list below the basic steps to run <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code></p>
<ul class="simple">
<li><p><strong>Step 1</strong>: loading modules</p></li>
</ul>
<p>On LUMI-G, the following modules need to be loaded:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>module<span class="w"> </span>load<span class="w"> </span>CrayEnv
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>module<span class="w"> </span>load<span class="w"> </span>rocm
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Step 2</strong>: generating <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code> script</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>hipify-clang<span class="w"> </span>--perl
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Step 3</strong>: running <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code></p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>perl<span class="w"> </span>hipify-perl<span class="w"> </span>program.cu<span class="w"> </span>&gt;<span class="w"> </span>program.cu.hip
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Step 4</strong>: compiling with <code class="docutils literal notranslate"><span class="pre">hipcc</span></code> the generated HIP code</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>hipcc<span class="w"> </span>--offload-arch<span class="o">=</span>gfx90a<span class="w"> </span>-o<span class="w"> </span>exec_hip<span class="w"> </span>program.cu.hip
</pre></div>
</div>
<p>Despite of the simplicity of the use of <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code>, the tool might not be suitable for large applications, as it relies heavily on substituting CUDA strings with HIP strings (e.g. it replaces <em>cuda</em> with <em>hip</em>). In addition, <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code> lacks the ability of <a class="reference external" href="https://docs.amd.com/bundle/HIPify-Reference-Guide-v5.1/page/HIPify.html#perl">distinguishing device/host function calls</a>. The alternative here is to use <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> as we shall describe in the next section.</p>
</section>
<section id="hipify-clang">
<span id="id1"></span><h3>Hipify-clang<a class="headerlink" href="#hipify-clang" title="Link to this heading"></a></h3>
<p>As described <a class="reference external" href="https://docs.amd.com/en-US/bundle/HIPify-Reference-Guide-v5.1/page/HIPify.html#perl">here</a>, the <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> tool is based on clang for translating CUDA sources into HIP sources. The tool is more robust for translating CUDA codes compared to the <code class="docutils literal notranslate"><span class="pre">hipify-perl</span></code> tool. Furthermore, it facilitates the analysis of the code by providing assistance.</p>
<p>In short, <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> requires <code class="docutils literal notranslate"><span class="pre">LLVM+CLANG</span></code> and <code class="docutils literal notranslate"><span class="pre">CUDA</span></code>. Details about building <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> can be found <a class="reference external" href="https://github.com/ROCm-Developer-Tools/HIPIFY">here</a>. Note that <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> is available on LUMI-G. The issue however might be related to the installation of CUDA-toolkit. To avoid any eventual issues with the installation procedure we opt for CUDA singularity container. Here we present a step-by-step guide for running <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code>:</p>
<ul class="simple">
<li><p><strong>Step 1</strong>: pulling a CUDA singularity container e.g.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>singularity<span class="w"> </span>pull<span class="w"> </span>docker://nvcr.io/nvidia/cuda:11.4.0-devel-ubuntu20.04
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Step 2</strong>: loading a ROCM module before launching the container.</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>ml<span class="w"> </span>rocm
</pre></div>
</div>
<p>During our testing, we used the rocm version <code class="docutils literal notranslate"><span class="pre">rocm-5.0.2</span></code>.</p>
<ul class="simple">
<li><p><strong>Step 3</strong>: launching the container</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>singularity<span class="w"> </span>shell<span class="w"> </span>-B<span class="w"> </span><span class="nv">$PWD</span>,/opt:/opt<span class="w"> </span>cuda_11.4.0-devel-ubuntu20.04.sif
</pre></div>
</div>
<p>where the current directory <code class="docutils literal notranslate"><span class="pre">$PWD</span></code> in the host is mounted to that of the container, and the directory <code class="docutils literal notranslate"><span class="pre">/opt</span></code> in the host is mounted to the that inside the container.</p>
<ul class="simple">
<li><p><strong>Step 4</strong>: setting the environment variable <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>
In order to run <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code> from inside the container, one can set the environment variable <code class="docutils literal notranslate"><span class="pre">$PATH</span></code> that defines tha path to look for the binary <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code></p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt/rocm-5.0.2/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Step 5</strong>: running <code class="docutils literal notranslate"><span class="pre">hipify-clang</span></code></p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>hipify-clang<span class="w"> </span>program.cu<span class="w"> </span>-o<span class="w"> </span>hip_program.cu.hip<span class="w"> </span>--cuda-path<span class="o">=</span>/usr/local/cuda-11.4<span class="w"> </span>-I<span class="w"> </span>/usr/local/cuda-11.4/include
</pre></div>
</div>
<p>Here the cuda path and the path to the <em>includes</em> and <em>defines</em> files should be specified. The CUDA source code and the generated output code are <code class="docutils literal notranslate"><span class="pre">program.cu</span></code> and <code class="docutils literal notranslate"><span class="pre">hip_program.cu.hip</span></code>, respectively.</p>
<ul class="simple">
<li><p><strong>Step 6</strong>: the syntax for compiling the generated hip code is similar to the one described in the previous section (see the hipify-perl section).</p></li>
</ul>
</section>
</section>
<section id="translating-cuda-to-sycl-with-syclomatic">
<span id="cuda2sycl"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Translating CUDA to SYCL with Syclomatic</a><a class="headerlink" href="#translating-cuda-to-sycl-with-syclomatic" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://github.com/oneapi-src/SYCLomatic">SYCLomatic</a> is another conversion tool. However, instead of converting CUDA code to HIP syntax, SYCLomatic converts the code to SYCL/DPC++. The use of SYCLomatic requires CUDA libraries, which can be directly installed in an environment or it can be extracted from a CUDA container. Similarly to previous section, we use singularity container. Here is a step-by-step guide for using <code class="docutils literal notranslate"><span class="pre">SYCLamatic</span></code></p>
<p><strong>Step 1</strong> Downloading <code class="docutils literal notranslate"><span class="pre">SYCLomatic</span></code> e.g. the last release from <a class="reference external" href="https://github.com/oneapi-src/SYCLomatic/releases">here</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wget https://github.com/oneapi-src/SYCLomatic/releases/download/20230208/linux_release.tgz</span>
</pre></div>
</div>
<p><strong>Step 2</strong> Decompressing the tarball into a desired location:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>tar<span class="w"> </span>-xvzf<span class="w"> </span>linux_release.tgz<span class="w"> </span>-C<span class="w"> </span><span class="o">[</span>desired<span class="w"> </span>install<span class="w"> </span>location<span class="o">]</span>
</pre></div>
</div>
<p><strong>Step 3</strong> Adding the the executable <code class="docutils literal notranslate"><span class="pre">c2s</span></code> which is located in <code class="docutils literal notranslate"><span class="pre">[install</span> <span class="pre">location]/bin</span></code> in your path, either by setting the environment variable <code class="docutils literal notranslate"><span class="pre">$PATH</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=[</span>install<span class="w"> </span>location<span class="o">]</span>/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>Or by creating a symbolic link into a local <code class="docutils literal notranslate"><span class="pre">bin</span></code> folder:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>ln<span class="w"> </span>-s<span class="w"> </span><span class="o">[</span>install<span class="w"> </span>location<span class="o">]</span>/bin/dpct<span class="w"> </span>/usr/bin/c2s
</pre></div>
</div>
<p><strong>Step 4</strong> <a name="SYCLomatic_s_4"></a> Launching <code class="docutils literal notranslate"><span class="pre">SYCLomatic</span></code>. This is done by running <code class="docutils literal notranslate"><span class="pre">c2s</span></code> from inside a CUDA container. This is similar to steps 1, 3 and 5 in the previous <a class="reference internal" href="#hipify-clang"><span class="std std-ref">section</span></a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>c2s<span class="w"> </span><span class="o">[</span>file<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>converted<span class="o">]</span>
</pre></div>
</div>
<p>This will create a folder in the current directory called <code class="docutils literal notranslate"><span class="pre">dpct_output</span></code>, in which the converted file is generated.</p>
<p><strong>Step 5</strong> Compiling the generated SYCL code</p>
<p><strong><em>step 5.1</em></strong> Look for errors in the converted file</p>
<p>In some cases, <code class="docutils literal notranslate"><span class="pre">SYCLOmatic</span></code> might not be able to convert part of the code. In such cases, <code class="docutils literal notranslate"><span class="pre">SYCLomatyic</span></code> will comment on the parts it is unsure about. For example, these comments might look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
    <span class="n">DPCT1003</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">Migrated</span> <span class="n">API</span> <span class="n">does</span> <span class="ow">not</span> <span class="k">return</span> <span class="n">error</span> <span class="n">code</span><span class="o">.</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">is</span> <span class="n">inserted</span><span class="o">.</span> <span class="n">You</span>
    <span class="n">may</span> <span class="n">need</span> <span class="n">to</span> <span class="n">rewrite</span> <span class="n">this</span> <span class="n">code</span><span class="o">.</span>
<span class="o">*/</span>
</pre></div>
</div>
<p>Before compiling, these sections will need to be manually checked for errors.</p>
<p><strong><em>step 5.2</em></strong>
Once you have a valid file, you may compile it with the SYCL compiler of your choosing. There are many choices for such compilers, which vary based on the devices you are compiling for. Please confer with the <a class="reference external" href="https://www.intel.com/content/www/us/en/developer/articles/technical/compiling-sycl-with-different-gpus.html">INTEL SYCL documentation</a> if you are unsure what compiler to use.</p>
<p><em>PS: Syclomatic generates data parallel C++ code (DPC++) in stead of a pure SYCL code. This means that you either need to manually convert the DPC++ code to SYCL if you want to use a pure SYCL compiler, or you need to use the intel OneAPI kit to compile the DPC++ code directly</em></p>
<p><strong><em>Compiling pure SYCL code</em></strong>
To compile the SYCL code on out clusters you need access to a SYCL compiler. On SAGA and BETZY this is straightforward and is discussed in this tutorial: <a class="reference external" href="https://documentation.sigma2.no/code_development/guides/hipsycl.html">What is SYCL</a>. At the time of writing, LUMI does not have a global installation of <code class="docutils literal notranslate"><span class="pre">hipSYCL</span></code>. We must therefore utilize easybuild to get access to it. The guidline for installing <code class="docutils literal notranslate"><span class="pre">hipSYCL</span></code> on LUMI can be found <a class="reference external" href="https://lumi-supercomputer.github.io/LUMI-EasyBuild-docs/h/hipSYCL/">here</a>. We assume that this is done in the path <code class="docutils literal notranslate"><span class="pre">/project/project_xxxxxxx/EasyBuild</span></code>. The following modules can be loaded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$export EBU_USER_PREFIX=/project/project_xxxxxxx/EasyBuild
$module load LUMI/22.08
$module load partition/G
$module load rocm
$module load hipSYCL/0.9.3-cpeCray-22.08
</pre></div>
</div>
<p>To test <code class="docutils literal notranslate"><span class="pre">hipSYCL</span></code>, the tutorial <a class="reference external" href="https://documentation.sigma2.no/code_development/guides/hipsycl.html">mentioned above</a> can be considered.</p>
<section id="launching-syclomatic-through-a-singularity-container">
<h3>Launching SYCLomatic through a singularity container<a class="headerlink" href="#launching-syclomatic-through-a-singularity-container" title="Link to this heading"></a></h3>
<p>An alternative to the steps mentioned above is to create a singularity .def file (see an example <a class="reference download internal" download="" href="../../_downloads/ec7a0f8bcf2cd85bfbf6d0dd5430080c/syclomatic.def"><span class="xref download myst">here</span></a>). This can be done in the following:</p>
<p>First, build a container image:</p>
<p><em>OBS: In most systems, you need sudo privileges to build the container. You do not have this on our clusters, you should therefore consider building a container locally and then copying it over to the cluster using <a class="reference external" href="https://documentation.sigma2.no/getting_started/getting_started.html#transferring-files">scp</a> or something similar.</em></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>singularity<span class="w"> </span>build<span class="w"> </span>syclomatic.sif<span class="w"> </span>syclomatic.def
</pre></div>
</div>
<p>Then execute the <code class="docutils literal notranslate"><span class="pre">SYCLomatic</span></code> tool from inside the container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>singularity<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>syclomatic.sif<span class="w"> </span>c2s<span class="w"> </span><span class="o">[</span>file<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>converted<span class="o">]</span>
</pre></div>
</div>
<p>This will create the same  <code class="docutils literal notranslate"><span class="pre">dpct_output</span></code> folder as mentioned in <em>step 4</em>.</p>
</section>
</section>
<section id="translate-openacc-to-openmp-with-clacc">
<span id="transl-acc-2-omp"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">Translate OpenACC to OpenMP with Clacc</a><a class="headerlink" href="#translate-openacc-to-openmp-with-clacc" title="Link to this heading"></a></h2>
<p><a class="reference external" href="https://github.com/llvm-doe-org/llvm-project/tree/clacc/main"><code class="docutils literal notranslate"><span class="pre">Clacc</span></code></a> is a tool to translate <code class="docutils literal notranslate"><span class="pre">OpenACC</span></code> to <code class="docutils literal notranslate"><span class="pre">OpenMP</span></code> offloading with the Clang/LLVM compiler environment. As indicated in the <a class="reference external" href="https://github.com/llvm-doe-org/llvm-project/tree/clacc/main">GitHub repository</a> the compiler <code class="docutils literal notranslate"><span class="pre">Clacc</span></code> is the <code class="docutils literal notranslate"><span class="pre">Clang</span></code>’s executable in the subdirectory <code class="docutils literal notranslate"><span class="pre">\bin</span></code> of the <code class="docutils literal notranslate"><span class="pre">\install</span></code> directory as described below.</p>
<p>In the following we present a step-by-step guide for building and using <a class="reference external" href="https://github.com/llvm-doe-org/llvm-project/tree/clacc/main"><code class="docutils literal notranslate"><span class="pre">Clacc</span></code></a>:</p>
<p><strong><em>Step 1.1</em></strong>
Load the following modules to be able to build <code class="docutils literal notranslate"><span class="pre">Clacc</span></code> (For LUMI-G):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">module load CrayEnv</span>
<span class="go">module load rocm</span>
</pre></div>
</div>
<p><strong><em>Step 1.2</em></strong>
Build and install <a class="reference external" href="https://github.com/llvm-doe-org/llvm-project/tree/clacc/main"><code class="docutils literal notranslate"><span class="pre">Clacc</span></code></a>.
The building process will spend about 5 hours.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>clacc/main<span class="w"> </span>https://github.com/llvm-doe-org/llvm-project.git
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>llvm-project
<span class="gp">$ </span>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
<span class="gp">$ </span>cmake<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>../install<span class="w">     </span><span class="se">\</span>
<span class="w">        </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w">            </span><span class="se">\</span>
<span class="w">        </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang;lld&quot;</span><span class="w">    </span><span class="se">\</span>
<span class="w">        </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span>openmp<span class="w">         </span><span class="se">\</span>
<span class="w">        </span>-DLLVM_TARGETS_TO_BUILD<span class="o">=</span><span class="s2">&quot;host;AMDGPU&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-DCMAKE_C_COMPILER<span class="o">=</span>gcc<span class="w">                </span><span class="se">\</span>
<span class="w">        </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>g++<span class="w">              </span><span class="se">\</span>
<span class="w">        </span>../llvm
<span class="gp">$ </span>make
<span class="gp">$ </span>make<span class="w"> </span>install
</pre></div>
</div>
<p><strong><em>Step 1.3</em></strong>
Set up environment variables to be able to work from the <code class="docutils literal notranslate"><span class="pre">/install</span></code> directory, which is the simplest way. For more advanced usage, which includes for instance modifying <code class="docutils literal notranslate"><span class="pre">Clacc</span></code>, we refer readers to <a class="reference external" href="https://github.com/llvm-doe-org/llvm-project/blob/clacc/main/README.md">“Usage from Build directory”</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/../install/bin:<span class="nv">$PATH</span>
<span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/../install/lib:<span class="nv">$LD_LIBRARY_PATH</span>
</pre></div>
</div>
<p><strong><em>Step 2</em></strong>
To compile the ported <code class="docutils literal notranslate"><span class="pre">OpenMP</span></code> code, one needs first to load these modules:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">module load CrayEnv</span>
<span class="go">module load PrgEnv-cray</span>
<span class="go">module load craype-accel-amd-gfx90a</span>
<span class="go">module load rocm</span>
</pre></div>
</div>
<p><strong><em>Step 2.1</em></strong>
Compile &amp; run an <code class="docutils literal notranslate"><span class="pre">OpenACC</span></code> code on a CPU-host:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clang<span class="w"> </span>-fopenacc<span class="w"> </span>openACC_code.c<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./executable
</pre></div>
</div>
<p><strong><em>Step 2.2</em></strong>
Compile &amp; run an <code class="docutils literal notranslate"><span class="pre">OpenACC</span></code> code on AMD GPU:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clang<span class="w"> </span>-fopenacc<span class="w"> </span>-fopenmp-targets<span class="o">=</span>amdgcn-amd-amdhsa<span class="w"> </span>-Xopenmp-target<span class="o">=</span>amdgcn-amd-amdhsa<span class="w"> </span>-march<span class="o">=</span>gfx90a<span class="w"> </span>openACC_code.c<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./executable
</pre></div>
</div>
<p><strong><em>Step 2.3</em></strong>
Source to source mode with <code class="docutils literal notranslate"><span class="pre">OpenMP</span></code> port printed out to the console:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>clang<span class="w"> </span>-fopenacc-print<span class="o">=</span>omp<span class="w"> </span>OpenACC_code.c
</pre></div>
</div>
<p><strong><em>Step 3</em></strong>
Compile the code with the <a class="reference external" href="https://docs.lumi-supercomputer.eu/development/compiling/prgenv/"><code class="docutils literal notranslate"><span class="pre">cc</span></code> compiler wrapper</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cc -fopenmp -o executable OpenMP_code.c</span>
</pre></div>
</div>
</section>
</section>
<section id="conclusion">
<h1><a class="toc-backref" href="#id6" role="doc-backlink">Conclusion</a><a class="headerlink" href="#conclusion" title="Link to this heading"></a></h1>
<p>We have presented an overview of the usage of available tools to convert CUDA codes to HIP and SYCL, and OpenACC codes to OpenMP offloading. In general the translation process for large applications might cover about 80% of the source code and thus requires manual modification to complete the porting process. It is however worth noting that the accuracy of the translation process requires that applications are written correctly according to the CUDA and OpenACC syntaxes.</p>
</section>
<section id="relevant-links">
<h1><a class="toc-backref" href="#id7" role="doc-backlink">Relevant links</a><a class="headerlink" href="#relevant-links" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://github.com/ROCm-Developer-Tools/HIPIFY">Hipify GitHub</a></p>
<p><a class="reference external" href="https://docs.amd.com/en-US/bundle/HIPify-Reference-Guide-v5.1/page/HIPify.html">HIPify Reference Guide v5.1</a></p>
<p><a class="reference external" href="https://github.com/olcf-tutorials/simple_HIP_examples/tree/master/vector_addition">HIP example</a></p>
<p><a class="reference external" href="https://www.admin-magazine.com/HPC/Articles/Porting-CUDA-to-HIP">Porting CUDA to HIP</a></p>
<p><a class="reference external" href="https://github.com/oneapi-src/SYCLomatic">SYCLomatic Github</a></p>
<p><a class="reference external" href="https://github.com/oneapi-src/SYCLomatic/releases">Installing SYCLamatic</a></p>
<p><a class="reference external" href="https://github.com/llvm-doe-org/llvm-project/blob/clacc/main/README.md">Clacc Main repository README</a></p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Sigma2/NRIS. Text shared under CC-BY 4.0 license.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>